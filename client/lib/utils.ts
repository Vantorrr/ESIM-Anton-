/**
 * –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω—ã
 * –ë—ç–∫–µ–Ω–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ü–µ–Ω—ã –≤ —Ä—É–±–ª—è—Ö
 */
export const formatPrice = (price: number | string): string => {
  const num = Number(price) || 0;
  return Math.round(num).toLocaleString('ru-RU');
};

/**
 * –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—ä—ë–º–∞ –¥–∞–Ω–Ω—ã—Ö
 * –ë—ç–∫–µ–Ω–¥ –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç ("500 MB", "20 GB")
 * –ù–æ –Ω–∞ —Å–ª—É—á–∞–π –±–∞–≥–æ–≤ - –∏—Å–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
 */
export const formatDataAmount = (amount: string): string => {
  if (!amount) return '';
  
  // –ï—Å–ª–∏ —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
  const match = amount.match(/^(\d+)\s*(MB|GB)$/i);
  if (!match) return amount;
  
  const value = parseInt(match[1], 10);
  const unit = match[2].toUpperCase();
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –±–∞–≥–∏ –±—ç–∫–µ–Ω–¥–∞:
  // –ï—Å–ª–∏ "500 GB" –Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ < 100 - —ç—Ç–æ –Ω–æ—Ä–º (500 GB = 500 –≥–∏–≥–∞–±–∞–π—Ç)
  // –ï—Å–ª–∏ "1024 GB" - —ç—Ç–æ —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –±–∞–≥, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "1 GB"
  // –ï—Å–ª–∏ "20480 GB" - —ç—Ç–æ –±–∞–≥, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "20 GB"
  
  if (unit === 'GB') {
    if (value >= 1000) {
      // –ë–∞–≥: –∑–Ω–∞—á–µ–Ω–∏–µ –≤ MB –ø–æ–∫–∞–∑–∞–Ω–æ –∫–∞–∫ GB
      // 1024 GB -> 1 GB, 20480 GB -> 20 GB
      const correctGB = Math.round(value / 1024);
      return `${correctGB} GB`;
    }
    if (value >= 100 && value < 1000) {
      // –ë–∞–≥: –∑–Ω–∞—á–µ–Ω–∏–µ –≤ MB –ø–æ–∫–∞–∑–∞–Ω–æ –∫–∞–∫ GB  
      // 500 GB -> 500 MB
      return `${value} MB`;
    }
  }
  
  return amount;
};

/**
 * –ü–æ–ª—É—á–∏—Ç—å ISO –∫–æ–¥ —Å—Ç—Ä–∞–Ω—ã (2 –±—É–∫–≤—ã)
 */
export const getCountryCode = (country: string): string => {
  if (!country) return 'XX';
  
  // –£–∂–µ ISO –∫–æ–¥
  if (/^[A-Za-z]{2}$/.test(country)) {
    return country.toUpperCase();
  }
  
  // –£–±–∏—Ä–∞–µ–º —Å—É—Ñ—Ñ–∏–∫—Å—ã —Ç–∏–ø–∞ AS-12, AF-29
  const match = country.match(/^([A-Za-z]{2})/);
  if (match) {
    return match[1].toUpperCase();
  }
  
  return 'XX';
};

/**
 * URL –∫–∞—Ä—Ç–∏–Ω–∫–∏ —Ñ–ª–∞–≥–∞ —á–µ—Ä–µ–∑ CDN (—Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö!)
 * –ò—Å–ø–æ–ª—å–∑—É–µ–º GitHub hosted —Ñ–ª–∞–≥–∏ - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –Ω–∞–¥—ë–∂–Ω–æ
 */
export const getFlagUrl = (country: string): string => {
  const code = getCountryCode(country).toLowerCase();
  if (code === 'xx') return '';
  
  // GitHub hosted —Ñ–ª–∞–≥–∏ - —Ä–∞–±–æ—Ç–∞—é—Ç –≤–µ–∑–¥–µ, –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
  return `https://hatscripts.github.io/circle-flags/flags/${code}.svg`;
};

/**
 * –ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã –ø–æ ISO –∫–æ–¥—É
 */
export const getCountryName = (country: string): string => {
  if (!country) return '–ú–∏—Ä';
  
  const code = getCountryCode(country);
  
  const names: Record<string, string> = {
    'AD': '–ê–Ω–¥–æ—Ä—Ä–∞', 'AE': '–û–ê–≠', 'AF': '–ê—Ñ–≥–∞–Ω–∏—Å—Ç–∞–Ω', 'AG': '–ê–Ω—Ç–∏–≥—É–∞',
    'AI': '–ê–Ω–≥–∏–ª—å—è', 'AL': '–ê–ª–±–∞–Ω–∏—è', 'AM': '–ê—Ä–º–µ–Ω–∏—è', 'AO': '–ê–Ω–≥–æ–ª–∞',
    'AR': '–ê—Ä–≥–µ–Ω—Ç–∏–Ω–∞', 'AS': '–ê–∑–∏—è', 'AT': '–ê–≤—Å—Ç—Ä–∏—è', 'AU': '–ê–≤—Å—Ç—Ä–∞–ª–∏—è',
    'AX': '–ê–ª–∞–Ω–¥—ã', 'AZ': '–ê–∑–µ—Ä–±–∞–π–¥–∂–∞–Ω', 'BA': '–ë–æ—Å–Ω–∏—è', 'BB': '–ë–∞—Ä–±–∞–¥–æ—Å',
    'BD': '–ë–∞–Ω–≥–ª–∞–¥–µ—à', 'BE': '–ë–µ–ª—å–≥–∏—è', 'BF': '–ë—É—Ä–∫–∏–Ω–∞-–§–∞—Å–æ', 'BG': '–ë–æ–ª–≥–∞—Ä–∏—è',
    'BH': '–ë–∞—Ö—Ä–µ–π–Ω', 'BJ': '–ë–µ–Ω–∏–Ω', 'BM': '–ë–µ—Ä–º—É–¥—ã', 'BN': '–ë—Ä—É–Ω–µ–π',
    'BO': '–ë–æ–ª–∏–≤–∏—è', 'BR': '–ë—Ä–∞–∑–∏–ª–∏—è', 'BS': '–ë–∞–≥–∞–º—ã', 'BT': '–ë—É—Ç–∞–Ω',
    'BW': '–ë–æ—Ç—Å–≤–∞–Ω–∞', 'BY': '–ë–µ–ª–∞—Ä—É—Å—å', 'BZ': '–ë–µ–ª–∏–∑', 'CA': '–ö–∞–Ω–∞–¥–∞',
    'CD': '–ö–æ–Ω–≥–æ', 'CF': '–¶–ê–†', 'CG': '–ö–æ–Ω–≥–æ', 'CH': '–®–≤–µ–π—Ü–∞—Ä–∏—è',
    'CI': '–ö–æ—Ç-–¥\'–ò–≤—É–∞—Ä', 'CL': '–ß–∏–ª–∏', 'CM': '–ö–∞–º–µ—Ä—É–Ω', 'CN': '–ö–∏—Ç–∞–π',
    'CO': '–ö–æ–ª—É–º–±–∏—è', 'CR': '–ö–æ—Å—Ç–∞-–†–∏–∫–∞', 'CU': '–ö—É–±–∞', 'CV': '–ö–∞–±–æ-–í–µ—Ä–¥–µ',
    'CW': '–ö—é—Ä–∞—Å–∞–æ', 'CY': '–ö–∏–ø—Ä', 'CZ': '–ß–µ—Ö–∏—è', 'DE': '–ì–µ—Ä–º–∞–Ω–∏—è',
    'DJ': '–î–∂–∏–±—É—Ç–∏', 'DK': '–î–∞–Ω–∏—è', 'DM': '–î–æ–º–∏–Ω–∏–∫–∞', 'DO': '–î–æ–º–∏–Ω–∏–∫–∞–Ω–∞',
    'DZ': '–ê–ª–∂–∏—Ä', 'EC': '–≠–∫–≤–∞–¥–æ—Ä', 'EE': '–≠—Å—Ç–æ–Ω–∏—è', 'EG': '–ï–≥–∏–ø–µ—Ç',
    'ER': '–≠—Ä–∏—Ç—Ä–µ—è', 'ES': '–ò—Å–ø–∞–Ω–∏—è', 'ET': '–≠—Ñ–∏–æ–ø–∏—è', 'EU': '–ï–≤—Ä–æ–ø–∞',
    'FI': '–§–∏–Ω–ª—è–Ω–¥–∏—è', 'FJ': '–§–∏–¥–∂–∏', 'FK': '–§–æ–ª–∫–ª–µ–Ω–¥—ã', 'FM': '–ú–∏–∫—Ä–æ–Ω–µ–∑–∏—è',
    'FO': '–§–∞—Ä–µ—Ä—ã', 'FR': '–§—Ä–∞–Ω—Ü–∏—è', 'GA': '–ì–∞–±–æ–Ω', 'GB': '–ë—Ä–∏—Ç–∞–Ω–∏—è',
    'GD': '–ì—Ä–µ–Ω–∞–¥–∞', 'GE': '–ì—Ä—É–∑–∏—è', 'GF': '–ì–≤–∏–∞–Ω–∞', 'GG': '–ì–µ—Ä–Ω—Å–∏',
    'GH': '–ì–∞–Ω–∞', 'GI': '–ì–∏–±—Ä–∞–ª—Ç–∞—Ä', 'GL': '–ì—Ä–µ–Ω–ª–∞–Ω–¥–∏—è', 'GM': '–ì–∞–º–±–∏—è',
    'GN': '–ì–≤–∏–Ω–µ—è', 'GP': '–ì–≤–∞–¥–µ–ª—É–ø–∞', 'GQ': '–≠–∫–≤. –ì–≤–∏–Ω–µ—è', 'GR': '–ì—Ä–µ—Ü–∏—è',
    'GT': '–ì–≤–∞—Ç–µ–º–∞–ª–∞', 'GU': '–ì—É–∞–º', 'GW': '–ì–≤–∏–Ω–µ—è-–ë–∏—Å–∞—É', 'GY': '–ì–∞–π–∞–Ω–∞',
    'HK': '–ì–æ–Ω–∫–æ–Ω–≥', 'HN': '–ì–æ–Ω–¥—É—Ä–∞—Å', 'HR': '–•–æ—Ä–≤–∞—Ç–∏—è', 'HT': '–ì–∞–∏—Ç–∏',
    'HU': '–í–µ–Ω–≥—Ä–∏—è', 'ID': '–ò–Ω–¥–æ–Ω–µ–∑–∏—è', 'IE': '–ò—Ä–ª–∞–Ω–¥–∏—è', 'IL': '–ò–∑—Ä–∞–∏–ª—å',
    'IM': '–ú—ç–Ω', 'IN': '–ò–Ω–¥–∏—è', 'IQ': '–ò—Ä–∞–∫', 'IR': '–ò—Ä–∞–Ω',
    'IS': '–ò—Å–ª–∞–Ω–¥–∏—è', 'IT': '–ò—Ç–∞–ª–∏—è', 'JE': '–î–∂–µ—Ä—Å–∏', 'JM': '–Ø–º–∞–π–∫–∞',
    'JO': '–ò–æ—Ä–¥–∞–Ω–∏—è', 'JP': '–Ø–ø–æ–Ω–∏—è', 'KE': '–ö–µ–Ω–∏—è', 'KG': '–ö–∏—Ä–≥–∏–∑–∏—è',
    'KH': '–ö–∞–º–±–æ–¥–∂–∞', 'KI': '–ö–∏—Ä–∏–±–∞—Ç–∏', 'KM': '–ö–æ–º–æ—Ä—ã', 'KN': '–°–µ–Ω—Ç-–ö–∏—Ç—Å',
    'KP': '–ö–ù–î–†', 'KR': '–ö–æ—Ä–µ—è', 'KW': '–ö—É–≤–µ–π—Ç', 'KY': '–ö–∞–π–º–∞–Ω—ã',
    'KZ': '–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω', 'LA': '–õ–∞–æ—Å', 'LB': '–õ–∏–≤–∞–Ω', 'LC': '–°–µ–Ω—Ç-–õ—é—Å–∏—è',
    'LI': '–õ–∏—Ö—Ç–µ–Ω—à—Ç–µ–π–Ω', 'LK': '–®—Ä–∏-–õ–∞–Ω–∫–∞', 'LR': '–õ–∏–±–µ—Ä–∏—è', 'LS': '–õ–µ—Å–æ—Ç–æ',
    'LT': '–õ–∏—Ç–≤–∞', 'LU': '–õ—é–∫—Å–µ–º–±—É—Ä–≥', 'LV': '–õ–∞—Ç–≤–∏—è', 'LY': '–õ–∏–≤–∏—è',
    'MA': '–ú–∞—Ä–æ–∫–∫–æ', 'MC': '–ú–æ–Ω–∞–∫–æ', 'MD': '–ú–æ–ª–¥–æ–≤–∞', 'ME': '–ß–µ—Ä–Ω–æ–≥–æ—Ä–∏—è',
    'MG': '–ú–∞–¥–∞–≥–∞—Å–∫–∞—Ä', 'MH': '–ú–∞—Ä—à–∞–ª–ª—ã', 'MK': '–ú–∞–∫–µ–¥–æ–Ω–∏—è', 'ML': '–ú–∞–ª–∏',
    'MM': '–ú—å—è–Ω–º–∞', 'MN': '–ú–æ–Ω–≥–æ–ª–∏—è', 'MO': '–ú–∞–∫–∞–æ', 'MP': '–ú–∞—Ä–∏–∞–Ω—ã',
    'MQ': '–ú–∞—Ä—Ç–∏–Ω–∏–∫–∞', 'MR': '–ú–∞–≤—Ä–∏—Ç–∞–Ω–∏—è', 'MS': '–ú–æ–Ω—Ç—Å–µ—Ä—Ä–∞—Ç', 'MT': '–ú–∞–ª—å—Ç–∞',
    'MU': '–ú–∞–≤—Ä–∏–∫–∏–π', 'MV': '–ú–∞–ª—å–¥–∏–≤—ã', 'MW': '–ú–∞–ª–∞–≤–∏', 'MX': '–ú–µ–∫—Å–∏–∫–∞',
    'MY': '–ú–∞–ª–∞–π–∑–∏—è', 'MZ': '–ú–æ–∑–∞–º–±–∏–∫', 'NA': '–ù–∞–º–∏–±–∏—è', 'NC': '–ö–∞–ª–µ–¥–æ–Ω–∏—è',
    'NE': '–ù–∏–≥–µ—Ä', 'NF': '–ù–æ—Ä—Ñ–æ–ª–∫', 'NG': '–ù–∏–≥–µ—Ä–∏—è', 'NI': '–ù–∏–∫–∞—Ä–∞–≥—É–∞',
    'NL': '–ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã', 'NO': '–ù–æ—Ä–≤–µ–≥–∏—è', 'NP': '–ù–µ–ø–∞–ª', 'NR': '–ù–∞—É—Ä—É',
    'NU': '–ù–∏—É—ç', 'NZ': '–ù. –ó–µ–ª–∞–Ω–¥–∏—è', 'OM': '–û–º–∞–Ω', 'PA': '–ü–∞–Ω–∞–º–∞',
    'PE': '–ü–µ—Ä—É', 'PF': '–ü–æ–ª–∏–Ω–µ–∑–∏—è', 'PG': '–ü–∞–ø—É–∞', 'PH': '–§–∏–ª–∏–ø–ø–∏–Ω—ã',
    'PK': '–ü–∞–∫–∏—Å—Ç–∞–Ω', 'PL': '–ü–æ–ª—å—à–∞', 'PM': '–°–µ–Ω-–ü—å–µ—Ä', 'PN': '–ü–∏—Ç–∫—ç—Ä–Ω',
    'PR': '–ü—É—ç—Ä—Ç–æ-–†–∏–∫–æ', 'PS': '–ü–∞–ª–µ—Å—Ç–∏–Ω–∞', 'PT': '–ü–æ—Ä—Ç—É–≥–∞–ª–∏—è', 'PW': '–ü–∞–ª–∞—É',
    'PY': '–ü–∞—Ä–∞–≥–≤–∞–π', 'QA': '–ö–∞—Ç–∞—Ä', 'RE': '–†–µ—é–Ω—å–æ–Ω', 'RO': '–†—É–º—ã–Ω–∏—è',
    'RS': '–°–µ—Ä–±–∏—è', 'RU': '–†–æ—Å—Å–∏—è', 'RW': '–†—É–∞–Ω–¥–∞', 'SA': '–°–∞—É–¥. –ê—Ä–∞–≤–∏—è',
    'SB': '–°–æ–ª–æ–º–æ–Ω—ã', 'SC': '–°–µ–π—à–µ–ª—ã', 'SD': '–°—É–¥–∞–Ω', 'SE': '–®–≤–µ—Ü–∏—è',
    'SG': '–°–∏–Ω–≥–∞–ø—É—Ä', 'SH': '–°–≤. –ï–ª–µ–Ω–∞', 'SI': '–°–ª–æ–≤–µ–Ω–∏—è', 'SK': '–°–ª–æ–≤–∞–∫–∏—è',
    'SL': '–°—å–µ—Ä—Ä–∞-–õ–µ–æ–Ω–µ', 'SM': '–°–∞–Ω-–ú–∞—Ä–∏–Ω–æ', 'SN': '–°–µ–Ω–µ–≥–∞–ª', 'SO': '–°–æ–º–∞–ª–∏',
    'SR': '–°—É—Ä–∏–Ω–∞–º', 'SS': '–Æ–∂. –°—É–¥–∞–Ω', 'ST': '–°–∞–Ω-–¢–æ–º–µ', 'SV': '–°–∞–ª—å–≤–∞–¥–æ—Ä',
    'SX': '–°–∏–Ω—Ç-–ú–∞—Ä—Ç–µ–Ω', 'SY': '–°–∏—Ä–∏—è', 'SZ': '–≠—Å–≤–∞—Ç–∏–Ω–∏', 'TC': '–¢—ë—Ä–∫—Å',
    'TD': '–ß–∞–¥', 'TG': '–¢–æ–≥–æ', 'TH': '–¢–∞–∏–ª–∞–Ω–¥', 'TJ': '–¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω',
    'TK': '–¢–æ–∫–µ–ª–∞—É', 'TL': '–¢–∏–º–æ—Ä', 'TM': '–¢—É—Ä–∫–º–µ–Ω–∏—è', 'TN': '–¢—É–Ω–∏—Å',
    'TO': '–¢–æ–Ω–≥–∞', 'TR': '–¢—É—Ä—Ü–∏—è', 'TT': '–¢—Ä–∏–Ω–∏–¥–∞–¥', 'TV': '–¢—É–≤–∞–ª—É',
    'TW': '–¢–∞–π–≤–∞–Ω—å', 'TZ': '–¢–∞–Ω–∑–∞–Ω–∏—è', 'UA': '–£–∫—Ä–∞–∏–Ω–∞', 'UG': '–£–≥–∞–Ω–¥–∞',
    'US': '–°–®–ê', 'UY': '–£—Ä—É–≥–≤–∞–π', 'UZ': '–£–∑–±–µ–∫–∏—Å—Ç–∞–Ω', 'VA': '–í–∞—Ç–∏–∫–∞–Ω',
    'VC': '–°–µ–Ω—Ç-–í–∏–Ω—Å–µ–Ω—Ç', 'VE': '–í–µ–Ω–µ—Å—É—ç–ª–∞', 'VG': '–ë—Ä–∏—Ç. –í–∏—Ä–≥–∏–Ω—ã',
    'VI': '–í–∏—Ä–≥–∏–Ω—ã –°–®–ê', 'VN': '–í—å–µ—Ç–Ω–∞–º', 'VU': '–í–∞–Ω—É–∞—Ç—É', 'WF': '–£–æ–ª–ª–∏—Å',
    'WS': '–°–∞–º–æ–∞', 'XK': '–ö–æ—Å–æ–≤–æ', 'YE': '–ô–µ–º–µ–Ω', 'YT': '–ú–∞–π–æ—Ç—Ç–∞',
    'ZA': '–Æ–ê–†', 'ZM': '–ó–∞–º–±–∏—è', 'ZW': '–ó–∏–º–±–∞–±–≤–µ',
    // –ú—É–ª—å—Ç–∏-—Ä–µ–≥–∏–æ–Ω—ã
    'XX': '–ú–∏—Ä',
  };
  
  return names[code] || country;
};

/**
 * –§–ª–∞–≥ —Å—Ç—Ä–∞–Ω—ã –ø–æ ISO –∫–æ–¥—É –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏—é (–¥–ª—è —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥–∞)
 * @deprecated –ò—Å–ø–æ–ª—å–∑—É–π getFlagUrl –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–æ–∫
 */
export const getCountryEmoji = (country: string): string => {
  if (!country) return 'üåç';
  
  const code = getCountryCode(country);
  if (code === 'XX') return 'üåç';
  
  const offset = 127397;
  try {
    return String.fromCodePoint(
      code.charCodeAt(0) + offset,
      code.charCodeAt(1) + offset
    );
  } catch {
    return 'üåç';
  }
};
